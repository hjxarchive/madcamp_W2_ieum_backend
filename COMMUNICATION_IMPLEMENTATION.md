# μ΄μ(Ieum) λ°±μ—”λ“ ν†µμ‹  κµ¬ν„ μ„¤λ…

## κ°μ”

μ΄μ λ°±μ—”λ“λ” **REST API**, **WebSocket**, **E2E μ•”νΈν™”**λ¥Ό κ²°ν•©ν• 3κ³„μΈµ ν†µμ‹  μ•„ν‚¤ν…μ²λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

- **μ „μ†΅ κ³„μΈµ**: HTTPS/TLS μ•”νΈν™” (Nginx)
- **μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ**: REST API + JWT μΈμ¦ (Spring Boot)
- **μ‹¤μ‹κ°„ κ³„μΈµ**: WebSocket + STOMP (μ±„ν…, μ•λ¦Ό)

## 1. μ „μ²΄ ν†µμ‹  μ•„ν‚¤ν…μ²

### 3κ³„μΈµ κµ¬μ΅°

**β‘  μ „μ†΅ κ³„μΈµ (Nginx)**
- HTTPS/TLS 1.2+ μ•”νΈν™”
- λ¦¬λ²„μ¤ ν”„λ΅μ‹λ΅ Spring Bootμ— μ”μ²­ μ „λ‹¬
- TLS ν„°λ―Έλ„¤μ΄μ… μ²λ¦¬
- μ¤‘κ°„μ κ³µκ²© λ°©μ§€

**β‘΅ μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ (Spring Boot)**
- REST API (HTTP + JSON)
- λ¨λ“  μ—”λ“ν¬μΈνΈ `/api` prefix μ‚¬μ©
- JWT μΈμ¦ μΈν„°μ…‰ν„°λ΅ μ‚¬μ©μ κ²€μ¦
- Google OAuth 2.0 β†’ JWT Access Token λ°κΈ‰ (HS256, 7μΌ μ ν¨)

**β‘Ά μ‹¤μ‹κ°„ ν†µμ‹  κ³„μΈµ (WebSocket)**
- WebSocket + STOMP ν”„λ΅ν† μ½
- μ—°κ²°: `ws://54.66.195.91/ws`
- μ±„λ„: `/topic` (λΈλ΅λ“μΊμ¤νΈ), `/user` (κ°μΈ)
- μ©λ„: μ±„ν…, MBTI μ—…λ°μ΄νΈ μ‹¤μ‹κ°„ μ•λ¦Ό

## 2. REST API ν†µμ‹  κµ¬μ΅°

### HTTP λ©”μ„λ“ & JSON

- **ν‘μ¤€ HTTP λ©”μ„λ“**: GET, POST, PUT, PATCH, DELETE
- **λ°μ΄ν„° ν•μ‹**: JSON (μ”μ²­/μ‘λ‹µ λ¨λ‘)
- **μμ‹**: `POST /api/events` β†’ μΌμ • μƒμ„± β†’ μ‘λ‹µμ— μƒμ„±λ μΌμ • ID ν¬ν•¨

### JWT ν† ν° μΈμ¦

```
Authorization: Bearer {accessToken}
```

**μΈμ¦ νλ¦„**:
1. ν΄λΌμ΄μ–ΈνΈ: HTTP ν—¤λ”μ— JWT ν† ν° ν¬ν•¨
2. μ„λ²„: JWT μΈν„°μ…‰ν„°κ°€ ν† ν° κ²€μ¦
   - μ„λ… μ ν¨μ„± ν™•μΈ (HS256)
   - λ§λ£ μ‹κ°„ ν™•μΈ (7μΌ)
   - μ‚¬μ©μ ID μ¶”μ¶
3. μ„±κ³µ: μ‚¬μ©μ μ •λ³΄λ¥Ό μ”μ²­ μ»¨ν…μ¤νΈμ— μ €μ¥
4. μ‹¤ν¨: 401 Unauthorized μ‘λ‹µ

### μ‘λ‹µ κµ¬μ΅°

**μ„±κ³µ (2xx)**:
```json
{
  "id": 123,
  "title": "λ°μ΄νΈ",
  "date": "2026-01-25"
}
```

**μ‹¤ν¨ (4xx, 5xx)**:
```json
{
  "message": "μ ν¨ν•μ§€ μ•μ€ μ΄λ€ μ½”λ“μ…λ‹λ‹¤"
}
```

### λ°μ΄ν„°λ² μ΄μ¤ ν†µμ‹ 

- **ORM**: JPA + Hibernate
- **κµ¬μ΅°**: Controller β†’ Service β†’ Repository β†’ PostgreSQL
- **νΈλμ­μ…**: `@Transactional` (μμ™Έ μ‹ μλ™ λ΅¤λ°±)

## 3. μΈμ¦ ν†µμ‹  νλ¦„ (Google OAuth + JWT)

### ν•μ΄λΈλ¦¬λ“ μΈμ¦ λ°©μ‹

**1λ‹¨κ³„: Google OAuth λ΅κ·ΈμΈ**
```
Client β†’ Google OAuth β†’ Google ID Token (RSA-2048 μ„λ…)
```
- μ‚¬μ©μ μ •λ³΄ ν¬ν•¨: μ΄λ©”μΌ, μ΄λ¦„, ν”„λ΅ν•„ μ΄λ―Έμ§€

**2λ‹¨κ³„: Google ID Token κ²€μ¦**
```
### ν”„λ΅ν† μ½

- **WebSocket**: Full-Duplex μ–‘λ°©ν–¥ ν†µμ‹  (μ§€μ†μ  μ—°κ²° μ μ§€)
- **STOMP**: Pub/Sub λ©”μ‹μ§• ν”„λ΅ν† μ½ (WebSocket μ„μ—μ„ λ™μ‘)

### μ—°κ²° μ„¤μ •

```
Client β†’ ws://54.66.195.91/ws β†’ HTTP Upgrade β†’ WebSocket
```

### μ±„λ„ κµ¬μ΅°

**λ©”μ‹μ§€ μ „μ†΅**: `/app/*`
- μ: `/app/chat.send` (μ±„ν… μ „μ†΅)

**κµ¬λ… (μμ‹ )**: `/topic/*`, `/user/*`
- `/user/{userId}/queue/messages` (κ°μΈ μ±„ν…)
- `/user/{userId}/topic/mbti-update` (MBTI μ—…λ°μ΄νΈ μ•λ¦Ό)

### μ±„ν… λ©”μ‹μ§€ νλ¦„

```
1. Client A β†’ /app/chat.send β†’ Server
2. Server: @MessageMapping λ©”μ„λ“μ—μ„ μ²λ¦¬
3. Server: E2E μ•”νΈν™”λ λ©”μ‹μ§€ DB μ €μ¥
4. Server: SimpMessagingTemplateμΌλ΅ λΈλ΅λ“μΊμ¤νΈ
5. Client A, B: /user/{userId}/queue/messages κµ¬λ…
6. μ‹¤μ‹κ°„ μμ‹  λ° ν™”λ©΄ ν‘μ‹
```

### MBTI μ—…λ°μ΄νΈ μ•λ¦Ό

```
1. User A: MBTI ν…μ¤νΈ μ μ¶ (POST /api/mbti/submit)
2. Server: DB μ—…λ°μ΄νΈ
3. Server: WebSocketμΌλ΅ Partner Bμ—κ² μ•λ¦Ό μ „μ†΅
4. Partner B: /user/{partnerId}/topic/mbti-update κµ¬λ…
5. μ¦‰μ‹ UI μ—…λ°μ΄νΈ (ν΄λ§ λ¶ν•„μ”)
```

### μ—°κ²° κ΄€λ¦¬

- **μλ™ μ¬μ—°κ²°**: μ—°κ²° λκΉ€ μ‹ 3μ΄ ν›„ μ¬μ‹λ„
- **ν•νΈλΉ„νΈ**: μ„λ²„κ°€ μ£ΌκΈ°μ μΌλ΅ μ—°κ²° μƒνƒ ν™•μΈ
### ν•μ΄λΈλ¦¬λ“ μ•”νΈν™” λ°©μ‹

- **RSA-2048**: ν‚¤ κµν™ (μ•μ „μ„±)
- **AES-256-GCM**: λ©”μ‹μ§€ μ•”νΈν™” (μ†λ„)

### ν‚¤ μƒμ„± λ° μ €μ¥

**1. λ΅κ·ΈμΈ μ‹ (Client)**
```
RSA Key Pair μƒμ„± (λ΅μ»¬)
β”β”€ Private Key: κΈ°κΈ°μ—λ§ μ €μ¥ (Keychain/Keystore) π”’
β””β”€ Public Key: μ„λ²„λ΅ μ „μ†΅ β†’ DB μ €μ¥
```

**ν•µμ‹¬ μ›μΉ™**: μ„λ²„λ” Private Keyμ— μ λ€ μ ‘κ·Ό λ¶κ°€

### μ»¤ν” μ—°κ²° μ‹ AES Key κµν™

**User B (μ—°κ²° μ‹μ‘μ)**
```
1. AES Shared Key μƒμ„± (256-bit)
2. User Aμ Public Keyλ΅ μ•”νΈν™” β†’ encryptedSharedKeyForUserA
3. User Bμ Public Keyλ΅ μ•”νΈν™” β†’ encryptedSharedKeyForUserB
4. λ‘ μ•”νΈν™”λ ν‚¤ λ¨λ‘ μ„λ²„ DBμ— μ €μ¥
```

**μ„λ²„**: μ•”νΈν™”λ ν‚¤λ§ λ³΄κ΄€, Shared Key μμ²΄λ” μ• μ μ—†μ

### λ©”μ‹μ§€ μ „μ†΅ νλ¦„

**μ†΅μ‹ μ (User A)**
```
1. μ„λ²„μ—μ„ encryptedSharedKeyForUserA κ°€μ Έμ¤κΈ°
2. μμ‹ μ Private Keyλ΅ λ³µνΈν™” β†’ AES Shared Key νλ“
3. λ©”μ‹μ§€λ¥Ό AES Shared Keyλ΅ μ•”νΈν™” (AES-256-GCM)
4. Base64 μΈμ½”λ”© β†’ μ„λ²„λ΅ μ „μ†΅
5. μ„λ²„: μ•”νΈν™”λ λ©”μ‹μ§€ κ·Έλ€λ΅ DB μ €μ¥ + WebSocket μ „λ‹¬
```

**μμ‹ μ (User B)**
```
1. μ„λ²„μ—μ„ encryptedSharedKeyForUserB κ°€μ Έμ¤κΈ°
2. μμ‹ μ Private Keyλ΅ λ³µνΈν™” β†’ AES Shared Key νλ“
3. μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό AES Shared Keyλ΅ λ³µνΈν™”
4. μ›λ³Έ λ©”μ‹μ§€ ν™”λ©΄ ν‘μ‹
```

### λ³΄μ• νΉμ§•

### μ—­ν• 

- ν΄λΌμ΄μ–ΈνΈ β†” Spring Boot μ‚¬μ΄μ λ¦¬λ²„μ¤ ν”„λ΅μ‹
- ν¬νΈ: 80 (HTTP), 443 (HTTPS)
- TLS ν„°λ―Έλ„¤μ΄μ…: HTTPS β†’ HTTP (λ‚΄λ¶€ λ„¤νΈμ›ν¬)

### HTTP μ”μ²­ ν”„λ΅μ‹

**location /**
```nginx
### μ—°κ²° κ΄€λ¦¬

- **ORM**: JPA + Hibernate
- **μ»¤λ„¥μ… ν’€**: HikariCP (μµλ€ 10κ° μ—°κ²°)
- **μ¥μ **: μ—°κ²° μ¬μ‚¬μ© β†’ μ¤λ²„ν—¤λ“ κ°μ†

### μ—”ν‹°ν‹° λ§¤ν•‘

```kotlin
@Entity
@Table(name = "users")
class User(
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long,
    
    val email: String,
    val name: String,
    
    @OneToOne
    val couple: Couple?
)
```

**κ΄€κ³„ λ§¤ν•‘**:
- `@OneToOne`: User β†” Couple
- `@ManyToOne`: Event β†’ User
- `@OneToMany`: Couple β†’ ChatMessages

### λ¦¬ν¬μ§€ν† λ¦¬

```kotlin
interface UserRepository : JpaRepository<User, Long> {
    fun findByEmail(email: String): User?
    fun findByCoupleId(coupleId: Long): List<User>
}
```

- κΈ°λ³Έ CRUD μλ™ μ κ³µ
- λ©”μ„λ“ μ΄λ¦„ κ·μΉ™ β†’ μΏΌλ¦¬ μλ™ μƒμ„±
- λ³µμ΅ν• μΏΌλ¦¬: `@Query` (JPQL/Native SQL)

### νΈλμ­μ… κ΄€λ¦¬

```kotlin
@Transactional
fun connectCouple(userId: Long, inviteCode: String) {
    // User μ—…λ°μ΄νΈ + Couple μƒμ„±
    // μμ™Έ λ°μƒ μ‹ μλ™ λ΅¤λ°±
}
```

- `@Transactional`: μ„ μ–Έμ  νΈλμ­μ…
- λ©”μ„λ“ μ‹μ‘: νΈλμ­μ… μ‹μ‘
- μ •μƒ μΆ…λ£: μ»¤λ°‹
- μμ™Έ λ°μƒ: μλ™ λ΅¤λ°± (λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥)

### WebSocket ν”„λ΅μ‹

**location /ws**
```nginx
### μ „μ—­ μ—λ¬ ν•Έλ“¤λ¬

```kotlin
@ControllerAdvice
class GlobalExceptionHandler {
    @ExceptionHandler(ResourceNotFoundException::class)
    fun handleNotFound(e: Exception): ResponseEntity<ErrorResponse> {
        return ResponseEntity.status(404).body(
            ErrorResponse("λ¦¬μ†μ¤λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤")
        )
    }
}
```

**HTTP μƒνƒ μ½”λ“**:
- `400`: Bad Request (μλ»λ μ”μ²­)
- `401`: Unauthorized (μΈμ¦ μ‹¤ν¨)
- `403`: Forbidden (κ¶ν• μ—†μ)
- `404`: Not Found (λ¦¬μ†μ¤ μ—†μ)
- `500`: Internal Server Error (μ„λ²„ μ¤λ¥)

### JWT μΈμ¦ μ—λ¬

- ν† ν° μ—†μ/μ ν¨ν•μ§€ μ•μ β†’ `401`
- ν† ν°μ€ μ ν¨ν•λ‚ κ¶ν• μ—†μ β†’ `403`

### λ΅κΉ… (SLF4J + Logback)

**INFO λ λ²¨**:
```
[INFO] GET /api/events - 200 OK (152ms)
```

**ERROR λ λ²¨**:
```
[ERROR] Failed to connect couple: Invalid invite code
StackTrace: ...
```

**WebSocket λ΅κΉ…**:
- μ—°κ²° μ„¤μ •/μΆ…λ£
- λ©”μ‹μ§€ μ „μ†΅
- μ—°κ²° μ‹¤ν¨ (WARN)
### 1. λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ μµμ ν™”

- **N+1 λ¬Έμ  λ°©μ§€**: `@EntityGraph`λ΅ ν• λ²μ— μ΅°μΈ
- **μΈλ±μ¤ μ„¤μ •**: μμ£Ό μ΅°νν•λ” μ»¬λΌ (email, couple_id λ“±)
- **μ„ νƒμ  μ΅°ν**: ν•„μ”ν• ν•„λ“λ§ SELECT

### 2. νμ΄μ§€λ„¤μ΄μ…

```kotlin
fun getMessages(coupleId: Long, page: Int, size: Int): Page<ChatMessage> {
### λ‹¤μΈµ λ³΄μ• κµ¬μ΅°

**κ³„μΈµ 1: μ „μ†΅ μ•”νΈν™”**
- HTTPS/TLS 1.2+
- λ„¤νΈμ›ν¬ μƒ λ°μ΄ν„° μ•”νΈν™”

**κ³„μΈµ 2: μΈμ¦ λ° μΈκ°€**
- JWT ν† ν° κΈ°λ° μΈμ¦
- μ‚¬μ©μ μ‹λ³„ λ° κ¶ν• κ²€μ¦

**κ³„μΈµ 3: λ°μ΄ν„° μ•”νΈν™”**
- μ±„ν… λ©”μ‹μ§€: E2E μ•”νΈν™” (AES-256-GCM)
- RSA Private Key: ν΄λΌμ΄μ–ΈνΈ λ΅μ»¬ μ €μ¥λ§

### κ³µκ²© λ°©μ–΄

| κ³µκ²© μ ν• | λ°©μ–΄ λ°©λ²• |
|---------|---------|
| **SQL μΈμ μ…** | JPA νλΌλ―Έν„° λ°”μΈλ”© (μ§μ ‘ λ¬Έμμ—΄ μ‚½μ… κΈμ§€) |
| **XSS** | HTML μ΄μ¤μΌ€μ΄ν”„ μ²λ¦¬, CSP ν—¤λ” |
| **CSRF** | JWT κΈ°λ° μΈμ¦ (μΏ ν‚¤ μ„Έμ… λ―Έμ‚¬μ©) |
| **DDoS** | Rate Limiting (IPλ³„ μ”μ²­ μ ν•) |
| **λ¬΄μ°¨λ³„ λ€μ…** | λ΅κ·ΈμΈ μ‹¤ν¨ νμ μ¶”μ  β†’ κ³„μ • μ κΈ |

### Rate Limiting

```
νΉμ • IPμ—μ„ μ§§μ€ μ‹κ°„ λ‚΄ κ³Όλ„ν• μ”μ²­
β†’ μΌμ‹ μ°¨λ‹¨ λλ” μ‘λ‹µ μ§€μ—°
```

---

## μ”μ•½

### ν†µμ‹  λ°©μ‹

| λ°©μ‹ | ν”„λ΅ν† μ½ | μ©λ„ | λ³΄μ• |
|-----|---------|------|------|
| **REST API** | HTTP + JSON | CRUD μ‘μ—… | HTTPS + JWT |
| **WebSocket** | WebSocket + STOMP | μ‹¤μ‹κ°„ μ±„ν…, μ•λ¦Ό | HTTPS + JWT |
| **E2E μ•”νΈν™”** | RSA-2048 + AES-256 | μ±„ν… λ©”μ‹μ§€ | μ„λ²„λ„ μ½μ„ μ μ—†μ |

### ν•µμ‹¬ κΈ°μ  μ¤νƒ

- **ν”„λ μ„μ›ν¬**: Spring Boot + Kotlin
- **λ°μ΄ν„°λ² μ΄μ¤**: PostgreSQL + JPA/Hibernate
- **μΈμ¦**: Google OAuth 2.0 + JWT (HS256)
- **ν”„λ΅μ‹**: Nginx (λ¦¬λ²„μ¤ ν”„λ΅μ‹ + TLS ν„°λ―Έλ„¤μ΄μ…)
- **μ•”νΈν™”**: RSA-2048 (ν‚¤ κµν™) + AES-256-GCM (λ©”μ‹μ§€)
- **μ‹¤μ‹κ°„**: WebSocket + STOMP
- **λ°°ν¬**: Docker Compose

### νΉμ§•

β… **μ•μ „μ„±**: λ‹¤μΈµ λ³΄μ• (HTTPS, JWT, E2E μ•”νΈν™”)  
β… **μ‹¤μ‹κ°„μ„±**: WebSocketμΌλ΅ ν΄λ§ μ—†μ΄ μ¦‰κ° μ•λ¦Ό  
β… **ν¨μ¨μ„±**: μ»¤λ„¥μ… ν’€, μΊμ‹±, νμ΄μ§€λ„¤μ΄μ…, λΉ„λ™κΈ° μ²λ¦¬  
β… **ν™•μ¥μ„±**: Docker κΈ°λ° λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ²

**ν¨κ³Ό**: μ΄κΈ° λ΅λ”© μ‹κ°„ λ‹¨μ¶•, λ„¤νΈμ›ν¬ λ€μ—­ν­ μ μ•½

### 3. μΊμ‹±

- **μ •μ  λ°μ΄ν„°**: MBTI μ§λ¬Έ λ©λ΅ (μ„λ²„ λ©”λ¨λ¦¬)
- **μ‚¬μ©μ μ •λ³΄**: JWT μΈμ¦ μ‹ μΌμ • μ‹κ°„ μΊμ‹±
- **ν¨κ³Ό**: DB μ΅°ν νμ κ°μ†

### 4. λΉ„λ™κΈ° μ²λ¦¬

```kotlin
@Async
fun uploadFile(file: MultipartFile) {
    // νμΌ μ—…λ΅λ“ μ²λ¦¬
    // μ™„λ£ ν›„ WebSocket μ•λ¦Ό
}
```

**μ μ©**:
- νμΌ μ—…λ΅λ“
- μ™Έλ¶€ API νΈμ¶
- μ΄λ©”μΌ μ „μ†΅

**ν¨κ³Ό**: λΈ”λ΅ν‚Ή μµμ†ν™”, μ¦‰μ‹ μ‘λ‹µ λ°ν™

```nginx
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Authorization, Content-Type
```
- Preflight μ”μ²­ (OPTIONS): μ¦‰μ‹ 204 μ‘λ‹µ
- λ‹¤λ¥Έ λ„λ©”μΈ/ν¬νΈμ—μ„ API μ ‘κ·Ό ν—μ©

β… **μ™„μ „ν• E2EE**
- μ¤μ§ λ€ν™” λ‹Ήμ‚¬μλ§ λ©”μ‹μ§€ μ½κΈ° κ°€λ¥
    "name": "ν™κΈΈλ™"
  }
}
```
- μ•κ³ λ¦¬μ¦: HS256
- λΉ„λ°€ ν‚¤: `JWT_SECRET_KEY` (ν™κ²½λ³€μ)
- λ§λ£: 7μΌ
- Payload: μ‚¬μ©μ ID

**5λ‹¨κ³„: ν† ν° μ €μ¥ λ° μ‚¬μ©**
- ν΄λΌμ΄μ–ΈνΈ: μ•μ „ν• μ €μ¥μ†μ— μ €μ¥ (Keychain/Keystore)
- μ΄ν›„ μ”μ²­: `Authorization: Bearer {accessToken}` ν—¤λ” ν¬ν•¨
- λ§λ£ μ‹: μ¬λ΅κ·ΈμΈ ν•„μ”

## 4. WebSocket μ‹¤μ‹κ°„ ν†µμ‹ 

μ‹¤μ‹κ°„ μ–‘λ°©ν–¥ ν†µμ‹ μ€ WebSocket ν”„λ΅ν† μ½κ³Ό STOMP(Simple Text Oriented Messaging Protocol) λ©”μ‹μ§• ν”„λ΅ν† μ½μ„ ν•¨κ» μ‚¬μ©ν•μ—¬ κµ¬ν„ν–μµλ‹λ‹¤. WebSocketμ€ HTTPμ™€ λ‹¬λ¦¬ μ—°κ²°μ„ μ§€μ†μ μΌλ΅ μ μ§€ν•λ©°, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ–Έμ λ“ μ§€ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ„ μ μλ” Full-Duplex ν†µμ‹ μ„ μ κ³µν•©λ‹λ‹¤. STOMPλ” WebSocket μ„μ—μ„ λ™μ‘ν•λ” λ©”μ‹μ§• ν”„λ΅ν† μ½λ΅, Pub/Sub ν¨ν„΄μ„ μ‰½κ² κµ¬ν„ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.

ν΄λΌμ΄μ–ΈνΈλ” `ws://54.66.195.91/ws` μ—”λ“ν¬μΈνΈλ΅ WebSocket μ—°κ²°μ„ μ‹μ‘ν•©λ‹λ‹¤. μ—°κ²° μ„¤μ • κ³Όμ •μ—μ„ HTTP Upgrade μ”μ²­μ„ λ³΄λ‚΄κ³ , μ„λ²„κ°€ μ΄λ¥Ό μλ½ν•λ©΄ WebSocket ν”„λ΅ν† μ½λ΅ μ „ν™λ©λ‹λ‹¤. μ΄ν›„ ν΄λΌμ΄μ–ΈνΈλ” STOMP ν”„λ΅ν† μ½μ„ ν†µν•΄ `/app` prefixλ¥Ό μ‚¬μ©ν•λ” λ©”μ‹μ§€ μ „μ†΅ μ±„λ„κ³Ό `/topic` λλ” `/user` prefixλ¥Ό μ‚¬μ©ν•λ” κµ¬λ… μ±„λ„μ„ ν™μ©ν•©λ‹λ‹¤.

μ±„ν… λ©”μ‹μ§€ μ „μ†΅μ„ μλ΅ λ“¤λ©΄, ν΄λΌμ΄μ–ΈνΈλ” `/app/chat.send` μ—”λ“ν¬μΈνΈλ΅ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•©λ‹λ‹¤. μ„λ²„μ `@MessageMapping` μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ λ©”μ„λ“κ°€ μ΄ λ©”μ‹μ§€λ¥Ό λ°›μ•„ μ²λ¦¬ν•κ³ , End-to-End μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•©λ‹λ‹¤. κ·Έλ° λ‹¤μ `SimpMessagingTemplate`μ„ μ‚¬μ©ν•μ—¬ νΉμ • μ»¤ν”μ λ‘ μ‚¬μ©μμ—κ²λ§ λ©”μ‹μ§€λ¥Ό λΈλ΅λ“μΊμ¤νΈν•©λ‹λ‹¤. κ° μ‚¬μ©μλ” `/user/{userId}/queue/messages` μ±„λ„μ„ κµ¬λ…ν•κ³  μμΌλ―€λ΅, μ„λ²„κ°€ μ΄ μ±„λ„λ΅ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ©΄ μ‹¤μ‹κ°„μΌλ΅ λ°›μ„ μ μμµλ‹λ‹¤.

MBTI ν…μ¤νΈ κ²°κ³Ό μ—…λ°μ΄νΈ μ•λ¦Όλ„ λ™μΌν• λ°©μ‹μΌλ΅ λ™μ‘ν•©λ‹λ‹¤. μ‚¬μ©μκ°€ MBTI ν…μ¤νΈλ¥Ό μ™„λ£ν•κ³  κ²°κ³Όλ¥Ό μ μ¶ν•λ©΄, μ„λ²„λ” λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ—…λ°μ΄νΈν• ν›„ WebSocketμ„ ν†µν•΄ ννΈλ„μ—κ² μ‹¤μ‹κ°„ μ•λ¦Όμ„ μ „μ†΅ν•©λ‹λ‹¤. ννΈλ„λ” `/user/{partnerId}/topic/mbti-update` μ±„λ„μ„ κµ¬λ…ν•κ³  μμΌλ©°, μ•λ¦Όμ„ λ°›μΌλ©΄ μ¦‰μ‹ UIλ¥Ό μ—…λ°μ΄νΈν•μ—¬ λ³€κ²½λ MBTI μ •λ³΄λ¥Ό ν‘μ‹ν•©λ‹λ‹¤. μ΄λ” ν΄λ§ λ°©μ‹μ— λΉ„ν•΄ ν›¨μ”¬ ν¨μ¨μ μ΄λ©°, μ‹¤μ‹κ°„μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.

WebSocket μ—°κ²°μ€ λ„¤νΈμ›ν¬ μƒνƒμ— λ”°λΌ λκΈΈ μ μμΌλ―€λ΅, ν΄λΌμ΄μ–ΈνΈλ” μλ™ μ¬μ—°κ²° λ΅μ§μ„ κµ¬ν„ν•΄μ•Ό ν•©λ‹λ‹¤. μ—°κ²°μ΄ λκΈ°λ©΄ μΌμ • μ‹κ°„(μ: 3μ΄) ν›„ μλ™μΌλ΅ μ¬μ—°κ²°μ„ μ‹λ„ν•κ³ , μ¬μ—°κ²°μ— μ„±κ³µν•λ©΄ μ΄μ „μ— κµ¬λ…ν–λ μ±„λ„μ„ λ‹¤μ‹ κµ¬λ…ν•©λ‹λ‹¤. μ„λ²„λ” ν•νΈλΉ„νΈ(Heartbeat) λ©”μ»¤λ‹μ¦μ„ ν†µν•΄ μ—°κ²° μƒνƒλ¥Ό μ£ΌκΈ°μ μΌλ΅ ν™•μΈν•λ©°, μ‘λ‹µμ΄ μ—†μΌλ©΄ μ—°κ²°μ„ μΆ…λ£ν•μ—¬ λ¦¬μ†μ¤λ¥Ό μ •λ¦¬ν•©λ‹λ‹¤.

## 5. End-to-End μ•”νΈν™” μ±„ν… ν†µμ‹ 

μ±„ν… λ©”μ‹μ§€λ” End-to-End μ•”νΈν™”(E2EE)λ¥Ό ν†µν•΄ μ„λ²„λ„ λ‚΄μ©μ„ μ½μ„ μ μ—†λ„λ΅ λ³΄νΈλ©λ‹λ‹¤. μ•”νΈν™” μ‹μ¤ν…μ€ RSA-2048 λΉ„λ€μΉ­ μ•”νΈν™”μ™€ AES-256-GCM λ€μΉ­ μ•”νΈν™”λ¥Ό μ΅°ν•©ν•μ—¬ κµ¬ν„ν–μµλ‹λ‹¤. RSAλ” ν‚¤ κµν™μ— μ‚¬μ©λκ³ , AESλ” μ‹¤μ  λ©”μ‹μ§€ μ•”νΈν™”μ— μ‚¬μ©λ©λ‹λ‹¤. μ΄λ” RSAμ μ•μ „ν• ν‚¤ κµν™κ³Ό AESμ λΉ λ¥Έ μ•”νΈν™” μ†λ„λ¥Ό λ¨λ‘ ν™μ©ν•λ” ν•μ΄λΈλ¦¬λ“ μ•”νΈν™” λ°©μ‹μ…λ‹λ‹¤.

μ‚¬μ©μκ°€ μ•±μ— μ²μ λ΅κ·ΈμΈν•λ©΄ ν΄λΌμ΄μ–ΈνΈλ” RSA Key Pair(κ³µκ° ν‚¤μ™€ κ°μΈ ν‚¤)λ¥Ό λ΅μ»¬μ—μ„ μƒμ„±ν•©λ‹λ‹¤. κ°μΈ ν‚¤λ” μ λ€ μ„λ²„λ΅ μ „μ†΅λμ§€ μ•μΌλ©°, μ¤μ§ μ‚¬μ©μμ κΈ°κΈ°μ—λ§ μ•μ „ν•κ² μ €μ¥λ©λ‹λ‹¤(iOS Keychain λλ” Android Keystore). κ³µκ° ν‚¤λ§ μ„λ²„λ΅ μ „μ†΅ν•μ—¬ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•©λ‹λ‹¤. μ΄ μ„¤κ³„λ” E2EEμ ν•µμ‹¬ μ›μΉ™μΌλ΅, μ„λ²„κ°€ κ°μΈ ν‚¤μ— μ ‘κ·Όν•  μ μ—†μΌλ―€λ΅ μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤.

λ‘ μ‚¬μ©μκ°€ μ»¤ν” μ—°κ²°μ„ μ™„λ£ν•λ©΄, μ—°κ²°μ„ μ‹μ‘ν• μ‚¬μ©μ(User B)κ°€ AES Shared Keyλ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ΄ Shared Keyλ” ν–¥ν›„ λ¨λ“  μ±„ν… λ©”μ‹μ§€λ¥Ό μ•”νΈν™”ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. User Bλ” μμ‹ μ κ³µκ° ν‚¤λ΅ Shared Keyλ¥Ό μ•”νΈν™”ν•μ—¬ `encryptedSharedKeyForUserB` ν•„λ“μ— μ €μ¥ν•κ³ , ννΈλ„(User A)μ κ³µκ° ν‚¤λ΅λ„ λ™μΌν• Shared Keyλ¥Ό μ•”νΈν™”ν•μ—¬ `encryptedSharedKeyForUserA` ν•„λ“μ— μ €μ¥ν•©λ‹λ‹¤. λ‘ μ•”νΈν™”λ ν‚¤ λ¨λ‘ μ„λ²„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λμ§€λ§, μ„λ²„λ” κ°μΈ ν‚¤κ°€ μ—†μΌλ―€λ΅ Shared Keyλ¥Ό μ•μ•„λ‚Ό μ μ—†μµλ‹λ‹¤.

μ±„ν… λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  λ•, ν΄λΌμ΄μ–ΈνΈλ” λ¨Όμ € μ„λ²„μ—μ„ μμ‹ μ μ•”νΈν™”λ Shared Keyλ¥Ό κ°€μ Έμµλ‹λ‹¤. μμ‹ μ κ°μΈ ν‚¤λ΅ μ΄λ¥Ό λ³µνΈν™”ν•μ—¬ μ‹¤μ  AES Shared Keyλ¥Ό μ–»κ³ , μ΄ ν‚¤λ΅ λ©”μ‹μ§€λ¥Ό AES-256-GCM μ•κ³ λ¦¬μ¦μΌλ΅ μ•”νΈν™”ν•©λ‹λ‹¤. μ•”νΈν™”λ λ©”μ‹μ§€λ” Base64 μΈμ½”λ”©λμ–΄ μ„λ²„λ΅ μ „μ†΅λ©λ‹λ‹¤. μ„λ²„λ” μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— κ·Έλ€λ΅ μ €μ¥ν•κ³ , WebSocketμ„ ν†µν•΄ ννΈλ„μ—κ² μ „λ‹¬ν•©λ‹λ‹¤. ννΈλ„λ” λ™μΌν• κ³Όμ •(μμ‹ μ μ•”νΈν™”λ Shared Keyλ¥Ό κ°μΈ ν‚¤λ΅ λ³µνΈν™” β†’ Shared Key νλ“ β†’ λ©”μ‹μ§€ λ³µνΈν™”)μ„ κ±°μ³ μ›λ³Έ λ©”μ‹μ§€λ¥Ό μ½μµλ‹λ‹¤.

μ΄ λ°©μ‹μ ν•µμ‹¬μ€ AES Shared Keyκ°€ ν•­μƒ ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„λ§ λ³µνΈν™”λλ‹¤λ” μ μ…λ‹λ‹¤. μ„λ²„λ” μ•”νΈν™”λ ν‚¤λ§ λ³΄κ΄€ν•  λΏ, μ‹¤μ  ν‚¤ κ°’μ„ μ• μ μ—†μµλ‹λ‹¤. λ”°λΌμ„ μ„λ²„κ°€ ν•΄ν‚Ήλ‹Ήν•κ±°λ‚ λ°μ΄ν„°λ² μ΄μ¤κ°€ μ μ¶λλ”λΌλ„, κ³µκ²©μλ” μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤. μ¤μ§ κ° μ‚¬μ©μμ κΈ°κΈ°μ— μ €μ¥λ κ°μΈ ν‚¤λ¥Ό κ°€μ§„ μ‚¬λλ§ λ©”μ‹μ§€λ¥Ό μ½μ„ μ μμµλ‹λ‹¤.

## 6. Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹μ™€ λΌμ°ν…

Nginxλ” ν΄λΌμ΄μ–ΈνΈμ™€ Spring Boot μ„λ²„ μ‚¬μ΄μ—μ„ λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ—­ν• μ„ μν–‰ν•©λ‹λ‹¤. λ¨λ“  μ™Έλ¶€ μ”μ²­μ€ λ¨Όμ € Nginxλ΅ λ“¤μ–΄μ¤κ³ , Nginxλ” μ”μ²­μ κ²½λ΅λ¥Ό λ¶„μ„ν•μ—¬ μ μ ν• λ°±μ—”λ“ μ„λ²„λ΅ μ „λ‹¬ν•©λ‹λ‹¤. κΈ°λ³Έμ μΌλ΅ 80λ² ν¬νΈ(HTTP)μ™€ 443λ² ν¬νΈ(HTTPS)μ—μ„ μ”μ²­μ„ λ°›μΌλ©°, HTTPS μ”μ²­μ€ TLS ν„°λ―Έλ„¤μ΄μ…μ„ κ±°μ³ λ³µνΈν™”λ ν›„ λ‚΄λ¶€ λ„¤νΈμ›ν¬μ—μ„ HTTPλ΅ Spring Bootμ— μ „λ‹¬λ©λ‹λ‹¤.

`location /` λΈ”λ΅μ€ λ¨λ“  HTTP μ”μ²­μ„ Spring Boot μ„λ²„(`http://spring-app:8080`)λ΅ ν”„λ΅μ‹ν•©λ‹λ‹¤. μ—¬κΈ°μ„ `spring-app`μ€ Docker Compose λ„¤νΈμ›ν¬ λ‚΄μ μ„λΉ„μ¤ μ΄λ¦„μΌλ΅, Dockerμ λ‚΄λ¶€ DNSλ¥Ό ν†µν•΄ ν•΄μ„λ©λ‹λ‹¤. `proxy_set_header` μ§€μ‹μ–΄λ¥Ό ν†µν•΄ μ›λ³Έ ν΄λΌμ΄μ–ΈνΈμ IP μ£Όμ†(`X-Real-IP`), ν”„λ΅ν† μ½(`X-Forwarded-Proto`), νΈμ¤νΈ μ •λ³΄(`Host`) λ“±μ„ ν—¤λ”μ— μ¶”κ°€ν•μ—¬ μ „λ‹¬ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ Spring Bootλ” ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  μ •λ³΄λ¥Ό νμ•…ν•  μ μμµλ‹λ‹¤.

WebSocket μ”μ²­μ€ νΉλ³„ν• μ²λ¦¬κ°€ ν•„μ”ν•©λ‹λ‹¤. `location /ws` λΈ”λ΅μ—μ„λ” HTTP ν”„λ΅ν† μ½μ„ WebSocketμΌλ΅ μ—…κ·Έλ μ΄λ“ν•κΈ° μ„ν•΄ `Connection: upgrade`μ™€ `Upgrade: websocket` ν—¤λ”λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤. λν• `proxy_read_timeout`μ„ 3600μ΄(1μ‹κ°„)λ΅ μ„¤μ •ν•μ—¬ WebSocket μ—°κ²°μ΄ μ¤λ«λ™μ• μ μ§€λ  μ μλ„λ΅ ν•©λ‹λ‹¤. μΌλ° HTTP μ”μ²­κ³Ό λ‹¬λ¦¬ WebSocketμ€ μ—°κ²°μ„ μ§€μ†μ μΌλ΅ μ μ§€ν•΄μ•Ό ν•λ―€λ΅, νƒ€μ„μ•„μ›ƒ μ„¤μ •μ΄ μ¤‘μ”ν•©λ‹λ‹¤.

CORS(Cross-Origin Resource Sharing) μ„¤μ •λ„ Nginxμ—μ„ μ²λ¦¬ν•©λ‹λ‹¤. ν”„λ΅ νΈμ—”λ“ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ λ‹¤λ¥Έ λ„λ©”μΈμ΄λ‚ ν¬νΈμ—μ„ μ‹¤ν–‰λ  λ•λ„ API μ”μ²­μ΄ κ°€λ¥ν•λ„λ΅ `Access-Control-Allow-Origin`, `Access-Control-Allow-Methods`, `Access-Control-Allow-Headers` ν—¤λ”λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤. νΉν `OPTIONS` λ©”μ„λ“(Preflight μ”μ²­)μ— λ€ν•΄μ„λ” λ°”λ΅ 204 μ‘λ‹µμ„ λ°ν™ν•μ—¬ μ‹¤μ  μ”μ²­ μ „μ— CORS κ²€μ¦μ΄ μ΄λ£¨μ–΄μ§€λ„λ΅ ν•©λ‹λ‹¤.

## 7. λ°μ΄ν„°λ² μ΄μ¤ ν†µμ‹  (JPA + PostgreSQL)

Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ€ JPA(Java Persistence API)μ™€ Hibernateλ¥Ό ν†µν•΄ PostgreSQL λ°μ΄ν„°λ² μ΄μ¤μ™€ ν†µμ‹ ν•©λ‹λ‹¤. λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°μ€ HikariCP μ»¤λ„¥μ… ν’€μ„ μ‚¬μ©ν•μ—¬ κ΄€λ¦¬λλ©°, μµλ€ 10κ°μ μ—°κ²°μ„ λ―Έλ¦¬ μƒμ„±ν•μ—¬ μ¬μ‚¬μ©ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ λ§¤λ² μƒλ΅μ΄ μ—°κ²°μ„ λ§Ίλ” μ¤λ²„ν—¤λ“λ¥Ό μ¤„μ΄κ³ , λ™μ‹ μ”μ²­μ„ ν¨μ¨μ μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤.

κ° μ—”ν‹°ν‹° ν΄λμ¤λ” λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”κ³Ό 1:1λ΅ λ§¤ν•‘λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, `User` μ—”ν‹°ν‹°λ” `users` ν…μ΄λΈ”κ³Ό λ§¤ν•‘λλ©°, `@Entity`, `@Table`, `@Id`, `@GeneratedValue` λ“±μ JPA μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ ν…μ΄λΈ” κµ¬μ΅°λ¥Ό μ •μν•©λ‹λ‹¤. μ—”ν‹°ν‹° κ°„μ κ΄€κ³„λ” `@ManyToOne`, `@OneToMany`, `@OneToOne` μ–΄λ…Έν…μ΄μ…μΌλ΅ ν‘ν„ν•λ©°, μλ¥Ό λ“¤μ–΄ `User`μ™€ `Couple`μ€ `@OneToOne` κ΄€κ³„μ…λ‹λ‹¤.

λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤λ” `JpaRepository`λ¥Ό μƒμ†ν•μ—¬ κΈ°λ³Έ CRUD λ©”μ„λ“λ¥Ό μλ™μΌλ΅ μ κ³µλ°›μµλ‹λ‹¤. μ¶”κ°€μ μΈ μΏΌλ¦¬κ°€ ν•„μ”ν• κ²½μ° λ©”μ„λ“ μ΄λ¦„ κ·μΉ™(μ: `findByEmail`, `findByCoupleId`)μ„ λ”°λ¥΄λ©΄ Spring Data JPAκ°€ μλ™μΌλ΅ μΏΌλ¦¬λ¥Ό μƒμ„±ν•©λ‹λ‹¤. λ³µμ΅ν• μΏΌλ¦¬λ” `@Query` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ JPQL(Java Persistence Query Language) λλ” Native SQLλ΅ μ§μ ‘ μ‘μ„±ν•©λ‹λ‹¤.

νΈλμ­μ… κ΄€λ¦¬λ” `@Transactional` μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ μ„ μ–Έμ μΌλ΅ μ²λ¦¬λ©λ‹λ‹¤. μ„λΉ„μ¤ λ©”μ„λ“μ— μ΄ μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ΄λ©΄ λ©”μ„λ“ μ‹μ‘ μ‹ νΈλμ­μ…μ΄ μ‹μ‘λκ³ , μ •μƒ μΆ…λ£ μ‹ μ»¤λ°‹λ©λ‹λ‹¤. λ§μ•½ λ©”μ„λ“ μ‹¤ν–‰ μ¤‘ μμ™Έκ°€ λ°μƒν•λ©΄ μλ™μΌλ΅ λ΅¤λ°±λμ–΄ λ°μ΄ν„° μΌκ΄€μ„±μ΄ λ³΄μ¥λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ»¤ν” μ—°κ²° κ³Όμ •μ—μ„ User μ—…λ°μ΄νΈμ™€ Couple μƒμ„±μ΄ λ¨λ‘ μ„±κ³µν•΄μ•Ό ν•λ―€λ΅, λ‘ μ‘μ—…μ„ ν•λ‚μ νΈλμ­μ…μΌλ΅ λ¬¶μ–΄ μ²λ¦¬ν•©λ‹λ‹¤.

## 8. μ—λ¬ μ²λ¦¬ λ° λ΅κΉ…

λ¨λ“  ν†µμ‹  κ³Όμ •μ—μ„ λ°μƒν•  μ μλ” μ—λ¬λ” μΌκ΄€λ λ°©μ‹μΌλ΅ μ²λ¦¬λ©λ‹λ‹¤. Spring Bootμ `@ControllerAdvice`μ™€ `@ExceptionHandler` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ μ „μ—­ μ—λ¬ ν•Έλ“¤λ¬λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤. μμ™Έκ°€ λ°μƒν•λ©΄ μ μ ν• HTTP μƒνƒ μ½”λ“μ™€ μ—λ¬ λ©”μ‹μ§€λ¥Ό JSON ν•μ‹μΌλ΅ λ°ν™ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ΅΄μ¬ν•μ§€ μ•λ” λ¦¬μ†μ¤μ— μ ‘κ·Όν•λ©΄ 404 μƒνƒ μ½”λ“μ™€ `{"message": "λ¦¬μ†μ¤λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤"}` κ°™μ€ λ©”μ‹μ§€λ¥Ό λ°ν™ν•©λ‹λ‹¤.

JWT μΈμ¦ μ‹¤ν¨λ” λ³„λ„μ μΈν„°μ…‰ν„°μ—μ„ μ²λ¦¬λ©λ‹λ‹¤. ν† ν°μ΄ μ—†κ±°λ‚ μ ν¨ν•μ§€ μ•μΌλ©΄ 401 Unauthorized μ‘λ‹µμ„ λ°ν™ν•κ³ , ν† ν°μ€ μ ν¨ν•μ§€λ§ ν•΄λ‹Ή λ¦¬μ†μ¤μ— μ ‘κ·Ό κ¶ν•μ΄ μ—†μΌλ©΄ 403 Forbiddenμ„ λ°ν™ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈλ” μ—λ¬μ μ›μΈμ„ λ…ν™•ν νμ•…ν•κ³  μ μ ν λ€μ‘ν•  μ μμµλ‹λ‹¤.

λ΅κΉ…μ€ SLF4Jμ™€ Logbackμ„ μ‚¬μ©ν•μ—¬ κµ¬ν„ν–μµλ‹λ‹¤. λ¨λ“  API μ”μ²­κ³Ό μ‘λ‹µμ€ INFO λ λ²¨λ΅ λ΅κΉ…λλ©°, μ”μ²­ λ©”μ„λ“, κ²½λ΅, μ†μ” μ‹κ°„ λ“±μ μ •λ³΄κ°€ κΈ°λ΅λ©λ‹λ‹¤. μ—λ¬λ” ERROR λ λ²¨λ΅ λ΅κΉ…λλ©°, μ¤νƒ νΈλ μ΄μ¤λ¥Ό ν¬ν•¨ν•μ—¬ λ””λ²„κΉ…μ„ λ•μµλ‹λ‹¤. ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” λ΅κ·Έλ¥Ό νμΌλ΅ μ €μ¥ν•κ³ , μΌμ • ν¬κΈ° μ΄μƒμ΄ λλ©΄ μλ™μΌλ΅ λ΅¤λ§ν•μ—¬ λ””μ¤ν¬ κ³µκ°„μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.

WebSocket ν†µμ‹ μ κ²½μ° μ—°κ²° μ„¤μ •, λ©”μ‹μ§€ μ „μ†΅, μ—°κ²° μΆ…λ£ λ“±μ μ΄λ²¤νΈκ°€ λ¨λ‘ λ΅κΉ…λ©λ‹λ‹¤. νΉν μ—°κ²° μ‹¤ν¨λ‚ μμƒμΉ λ»ν• μ—°κ²° μΆ…λ£λ” WARN λ λ²¨λ΅ κΈ°λ΅ν•μ—¬ λ„¤νΈμ›ν¬ λ¬Έμ λ¥Ό μ¶”μ ν•  μ μμµλ‹λ‹¤. μ΄λ¬ν• λ΅κ·Έλ” μ΄μ μ¤‘ λ°μƒν•λ” λ¬Έμ λ¥Ό μ‹ μ†ν•κ² νμ•…ν•κ³  ν•΄κ²°ν•λ” λ° ν•„μμ μ…λ‹λ‹¤.

## 9. μ„±λ¥ μµμ ν™”

ν†µμ‹  μ„±λ¥μ„ μµμ ν™”ν•κΈ° μ„ν•΄ μ—¬λ¬ μ „λµμ„ μ‚¬μ©ν–μµλ‹λ‹¤. μ²«μ§Έ, λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ μµμ ν™”λ¥Ό ν†µν•΄ λ¶ν•„μ”ν• μ΅°μΈμ„ μ¤„μ΄κ³ , ν•„μ”ν• λ°μ΄ν„°λ§ μ„ νƒμ μΌλ΅ κ°€μ Έμµλ‹λ‹¤. `@EntityGraph` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ N+1 λ¬Έμ λ¥Ό λ°©μ§€ν•κ³ , μΈλ±μ¤λ¥Ό μ μ ν μ„¤μ •ν•μ—¬ μ΅°ν μ†λ„λ¥Ό ν–¥μƒμ‹μΌ°μµλ‹λ‹¤.

λ‘μ§Έ, νμ΄μ§€λ„¤μ΄μ…μ„ ν†µν•΄ λ€λ‰μ λ°μ΄ν„°λ¥Ό ν• λ²μ— μ „μ†΅ν•μ§€ μ•κ³  λ‚λ μ„ μ „μ†΅ν•©λ‹λ‹¤. μ±„ν… λ©”μ‹μ§€ μ΅°νλ‚ μΌμ • λ©λ΅ μ΅°ν μ‹ `Pageable` νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•μ—¬ νμ΄μ§€ ν¬κΈ°μ™€ λ²νΈλ¥Ό μ§€μ •ν•  μ μμµλ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ΄κΈ° λ΅λ”© μ‹κ°„μ„ μ¤„μ΄κ³ , λ„¤νΈμ›ν¬ λ€μ—­ν­μ„ μ μ•½ν•©λ‹λ‹¤.

μ…‹μ§Έ, μΊμ‹±μ„ ν†µν•΄ λ°λ³µμ μΌλ΅ μ”μ²­λλ” λ°μ΄ν„°μ μ‘λ‹µ μ‹κ°„μ„ λ‹¨μ¶•ν•©λ‹λ‹¤. MBTI μ§λ¬Έ λ©λ΅μ²λΌ λ³€κ²½λμ§€ μ•λ” μ •μ  λ°μ΄ν„°λ” μ„λ²„ λ©”λ¨λ¦¬μ— μΊμ‹±ν•μ—¬, λ§¤λ² λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ΅°νν•μ§€ μ•λ„λ΅ ν•©λ‹λ‹¤. μ‚¬μ©μ μ •λ³΄λ„ μΌμ • μ‹κ°„ λ™μ• μΊμ‹±ν•μ—¬ JWT μΈμ¦ κ³Όμ •μ λ°μ΄ν„°λ² μ΄μ¤ μ΅°νλ¥Ό μ¤„μ…λ‹λ‹¤.

λ„·μ§Έ, λΉ„λ™κΈ° μ²λ¦¬λ¥Ό ν†µν•΄ λΈ”λ΅ν‚Ήμ„ μµμ†ν™”ν•©λ‹λ‹¤. νμΌ μ—…λ΅λ“λ‚ μ™Έλ¶€ API νΈμ¶ κ°™μ€ μ‹κ°„μ΄ μ¤λ κ±Έλ¦¬λ” μ‘μ—…μ€ λ³„λ„μ μ¤λ λ“ ν’€μ—μ„ λΉ„λ™κΈ°λ΅ μ²λ¦¬ν•κ³ , ν΄λΌμ΄μ–ΈνΈμ—λ” μ¦‰μ‹ μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤. μ‘μ—… μ™„λ£ ν›„μ—λ” WebSocketμ„ ν†µν•΄ κ²°κ³Όλ¥Ό μ•λ¦½λ‹λ‹¤.

## 10. λ³΄μ• ν†µμ‹  μ „λµ

λ¨λ“  ν†µμ‹ μ€ λ‹¤μΈµ λ³΄μ• μ „λµμ„ λ”°λ¦…λ‹λ‹¤. μ²« λ²μ§Έ κ³„μΈµμ€ μ „μ†΅ μ•”νΈν™”λ΅, HTTPS/TLSλ¥Ό ν†µν•΄ λ„¤νΈμ›ν¬ μƒμ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•©λ‹λ‹¤. λ‘ λ²μ§Έ κ³„μΈµμ€ μΈμ¦ λ° μΈκ°€λ΅, JWT ν† ν°μ„ ν†µν•΄ μ‚¬μ©μλ¥Ό μ‹λ³„ν•κ³  κ¶ν•μ„ κ²€μ¦ν•©λ‹λ‹¤. μ„Έ λ²μ§Έ κ³„μΈµμ€ λ°μ΄ν„° μ•”νΈν™”λ΅, λ―Όκ°ν• λ°μ΄ν„°(μ±„ν… λ©”μ‹μ§€, RSA ν‚¤ λ“±)λ” μ•”νΈν™”ν•μ—¬ μ €μ¥ν•©λ‹λ‹¤.

SQL μΈμ μ… κ³µκ²©μ„ λ°©μ§€ν•κΈ° μ„ν•΄ JPAμ νλΌλ―Έν„° λ°”μΈλ”©μ„ μ‚¬μ©ν•λ©°, μ‚¬μ©μ μ…λ ¥μ„ μ§μ ‘ μΏΌλ¦¬ λ¬Έμμ—΄μ— μ‚½μ…ν•μ§€ μ•μµλ‹λ‹¤. XSS(Cross-Site Scripting) κ³µκ²©μ„ λ°©μ§€ν•κΈ° μ„ν•΄ μ‚¬μ©μκ°€ μ…λ ¥ν• HTML νƒκ·Έλ” μ΄μ¤μΌ€μ΄ν”„ μ²λ¦¬ν•κ³ , Content Security Policy ν—¤λ”λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. CSRF(Cross-Site Request Forgery) κ³µκ²©μ€ JWT κΈ°λ° μΈμ¦μ„ μ‚¬μ©ν•¨μΌλ΅μ¨ λ°©μ§€λλ©°, μΏ ν‚¤ κΈ°λ° μ„Έμ…μ„ μ‚¬μ©ν•μ§€ μ•μµλ‹λ‹¤.

Rate Limitingμ„ ν†µν•΄ DDoS κ³µκ²©μ΄λ‚ λ¬΄μ°¨λ³„ λ€μ… κ³µκ²©μ„ λ°©μ–΄ν•©λ‹λ‹¤. νΉμ • IPμ—μ„ μ§§μ€ μ‹κ°„ λ™μ• λ„λ¬΄ λ§μ€ μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄ μΌμ‹μ μΌλ΅ μ°¨λ‹¨ν•κ±°λ‚ μ‘λ‹µμ„ μ§€μ—°μ‹ν‚µλ‹λ‹¤. λ΅κ·ΈμΈ μ‹¤ν¨ νμλ¥Ό μ¶”μ ν•μ—¬ μΌμ • νμ μ΄μƒ μ‹¤ν¨ν•λ©΄ κ³„μ •μ„ μ κ·Έλ” κΈ°λ¥λ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.

## κ²°λ΅ 

μ΄μ λ°±μ—”λ“μ ν†µμ‹  μ‹μ¤ν…μ€ REST API, WebSocket, E2E μ•”νΈν™”λ¥Ό κ²°ν•©ν•μ—¬ μ•μ „ν•κ³  ν¨μ¨μ μ΄λ©° μ‹¤μ‹κ°„μ„±μ„ κ°–μ¶ μ•„ν‚¤ν…μ²λ¥Ό κµ¬μ¶•ν–μµλ‹λ‹¤. HTTPS/TLS κΈ°λ°μ μ „μ†΅ μ•”νΈν™”, JWT κΈ°λ°μ μΈμ¦, End-to-End μ•”νΈν™”λ¥Ό ν†µν• λ°μ΄ν„° λ³΄νΈ, WebSocketμ„ ν†µν• μ‹¤μ‹κ°„ ν†µμ‹ , κ·Έλ¦¬κ³  Nginxμ™€ Dockerλ¥Ό ν™μ©ν• ν™•μ¥ κ°€λ¥ν• μΈν”„λΌλ” ν„λ€μ μΈ μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ μ”κµ¬μ‚¬ν•­μ„ μ¶©μ΅±ν•©λ‹λ‹¤. κ° κ³„μΈµμ΄ λ…λ¦½μ μΌλ΅ λ™μ‘ν•λ©΄μ„λ„ μ κΈ°μ μΌλ΅ μ—°κ²°λμ–΄, μ‚¬μ©μμ—κ² μ•μ „ν•κ³  λΉ λ¥Έ μ„λΉ„μ¤λ¥Ό μ κ³µν•©λ‹λ‹¤.
